const t={ID_BUTTON_RUN:"id_button_run",ID_TEXT_FROM:"id_text_from",ID_TEXT_TO:"id_text_to",ID_LENGTH_FROM:"id_length_from",ID_LENGTH_TO:"id_length_to",ID_BUTTONS:"id_buttons_block",ID_LIMIT_LENGTH:"id_limit_length",ID_BTN_COPY:"id_button_copy",STYLE_COPY_DEFAULT:"btn-info",STYLE_COPY_SUCCESS:"btn-outline-success",VALUE_BTN_COPY:"copy to clipboard",RE_SHRINK:"([─━=━┏])\\1+",RE_URL:"https?://[\\w!?/+-=_~;.,*&@#$%()'[\\]]+",LIMIT_LENGTH:2e4};class e{constructor(t=1e4){this.title="",this.raw_body="",this.bodies=[],this.max_part_length=t}proc(t){if(0==t.length)throw new Error("メール本文が未入力です。");return this.raw_body=t,t=this.regex_convert(t),this.bodies=this.split_body(t,this.max_part_length),this.bodies}regex_convert(e){let n;const o=new RegExp(t.RE_SHRINK,"g");n=e.replace(o,"$1");const r=new RegExp(t.RE_URL,"g");return n=n.replace(r,"(URL)"),console.log(n.length),n}split_body(t,e){if(t.length<e)return[t];return t.split(/\n\n/).reduce(((t,n)=>{n+="\n\n";const o=t[t.length-1].length;return o>0&&o+n.length>e?t.push(n):t[t.length-1]=t[t.length-1].concat(n),t}),[""])}}class n{static is_not_empty_string(t){return!n.is_empty_string(t)}static is_empty_string(t){return null==t||null==t||!(t.length>0)}static get_from=(t,e,n)=>t.hasOwnProperty(e)?t[e]:n;static createElement=(t,e="",n=[],o="",r)=>{const c=document.createElement(t);return c.className=e,c.textContent=o,n.length>0&&n.forEach((t=>{c.appendChild(t)})),r&&Object.entries(r).forEach((([t,e])=>{c.setAttribute(t,e)})),c};static ce=(t,e="",n=[],o="",r)=>this.createElement(t,e,n,o,r);static decorate_menu_icon(t){return t.style.height="48px",t.style.backgroundColor="#f7f9fa",t.style.fontSize="28px",t.style.border="1px solid #e3e7e8",t.style.display="inline",t.style.marginLeft="2px",t.style.marginRight="2px",t.style.verticalAlign="middle",t}static simpleDiv=t=>n.createElement("div","",[],t);static is_overlapped=t=>n.overlapped(t).length>0;static overlapped=t=>{const e=t.filter(((t,e,n)=>n.indexOf(t)!==n.lastIndexOf(t)));return Array.from(new Set(e))};static get_application_url(t){return`${location.protocol}//${location.host}/k/${t}`}static retrieve_errors(t,e=-1){const n=t?.error?.errors;if(null==n)return;let o=[];if(Object.keys(n).forEach((t=>{const e=n[t].messages.map((e=>`[${t}] ${e}`));o=o.concat(e)})),o.sort(),e>=0&&e<o.length){const t=o.length-e;o=o.splice(0,e),o.push(`以下${t}件のエラーメッセージを省略しました。`)}return o}}class o{constructor(t){this.top_id=t}build(){this.build_forms(this.top_id)}build_forms(e){const r=document.getElementById(e);r?.setAttribute("class","me-5");const c=n.ce("input","btn btn-primary mb-3",[],"",{type:"button",value:"prepare",id:t.ID_BUTTON_RUN});c.addEventListener("click",o.run);const s=n.ce("input","float-end ms-2",[],"",{id:t.ID_LIMIT_LENGTH,value:`${t.LIMIT_LENGTH}`}),l=o.create_textarea(t.ID_TEXT_FROM,"入力テキスト");l.addEventListener("change",o.change_from);const i=o.create_textarea(t.ID_TEXT_TO,"読み上げ用テキスト");i.addEventListener("change",o.change_to);const _=o.create_copybutton(t.ID_BTN_COPY,"copy to clipboard"),a=n.ce("div","",[n.ce("span","float-end",[],"",{id:t.ID_LENGTH_FROM}),l,n.ce("div","float-end",[s],"分割文字数の目安: "),n.ce("div","",[c]),n.ce("span","float-end",[],"",{id:t.ID_LENGTH_TO}),i,_,n.ce("div","",[],"",{id:t.ID_BUTTONS})]);r?.append(a)}static run(){o.clear_copybutton(t.ID_BTN_COPY);const r=o.get_from_field(),c=(o.get_to_field(),document.getElementById(t.ID_LIMIT_LENGTH)),s=new e(parseInt(c.value)).proc(r.value);console.log(s);const l=o.list_splitted_contents(s),i=n.ce("div","btn-group",l),_=document.getElementById(t.ID_BUTTONS);_&&(Array.from(_.childNodes).forEach((t=>{t.remove()})),_?.append(i)),l[0].dispatchEvent(new Event("click"))}static list_splitted_contents(e){const r=o.get_to_field();let c=0;return e.map((e=>{c++;const s=n.ce("input","btn  btn-secondary",[],"",{type:"button",value:`page ${c}`});return s.addEventListener("click",(n=>{r.value=e,o.change_to(),o.clear_copybutton(t.ID_BTN_COPY)})),s}))}static convert(e){if(null==e)return"";let n;const o=new RegExp(t.RE_SHRINK,"g");n=e.replace(o,"$1");const r=new RegExp(t.RE_URL,"g");return n=n.replace(r,"(URL)"),console.log(n.length),n}static change_from(){console.log("change from");const e=o.get_from_field().value.length,n=document.getElementById(t.ID_LENGTH_FROM);n&&(n.textContent=e.toString())}static change_to(){console.log("change to");const e=o.get_to_field().value.length,n=document.getElementById(t.ID_LENGTH_TO);n&&(n.textContent=e.toString())}static get_from_field(){const e=document.getElementById(t.ID_TEXT_FROM);if(null===e)throw new Error("fromノードが取得できませんでした。");return e}static get_to_field(){const e=document.getElementById(t.ID_TEXT_TO);if(null===e)throw new Error("toノードが取得できませんでした。");return e}static read_to_field(){return o.get_to_field().value}static create_textarea(t,e){const o=n.ce("textarea","form-control",[],"",{id:t,cols:"10",rows:"5"});return o.style.overflowX="scroll",n.ce("div","mb-3",[n.ce("label","form-label",[],e,{for:t}),o])}static create_copybutton(e,r){const c=t.STYLE_COPY_DEFAULT,s=n.ce("input","btn float-end mee-2",[],"",{id:t.ID_BTN_COPY,value:t.VALUE_BTN_COPY});return s.classList.add(c),s.addEventListener("click",(e=>{const n=o.read_to_field();navigator.clipboard.writeText(n).then((e=>{s.setAttribute("value","success!"),s.classList.remove(c),s.classList.add(t.STYLE_COPY_SUCCESS)})).catch((t=>{s.setAttribute("value","failed!")}))})),s}static clear_copybutton(e){const n=t.STYLE_COPY_DEFAULT,o=document.getElementById(t.ID_BTN_COPY);o&&(o.classList.remove(t.STYLE_COPY_SUCCESS),o.classList.add(n),o.setAttribute("value",t.VALUE_BTN_COPY))}}!function(){console.log("run script.");new o("app").build()}();