const t={ID_BUTTON_RUN:"id_button_run",ID_TEXT_FROM:"id_text_from",ID_TEXT_TO:"id_text_to",ID_LENGTH_FROM:"id_length_from",ID_LENGTH_TO:"id_length_to",ID_BUTTONS:"id_buttons_block",ID_LIMIT_LENGTH:"id_limit_length",RE_SHRINK:"([─━=━┏])\\1+",RE_URL:"https?://[\\w!?/+-=_~;.,*&@#$%()'[\\]]+",LIMIT_LENGTH:1e4};class e{constructor(t=1e4){this.title="",this.raw_body="",this.bodies=[],this.max_part_length=t}proc(t){if(0==t.length)throw new Error("メール本文が未入力です。");return this.raw_body=t,t=this.regex_convert(t),this.bodies=this.split_body(t,this.max_part_length),this.bodies}regex_convert(e){let n;const r=new RegExp(t.RE_SHRINK,"g");n=e.replace(r,"$1");const o=new RegExp(t.RE_URL,"g");return n=n.replace(o,"(URL)"),console.log(n.length),n}split_body(t,e){if(t.length<e)return[t];return t.split(/\n\n/).reduce(((t,n)=>{n+="\n\n";return t[t.length-1].length+n.length>e?t.push(n):t[t.length-1]=t[t.length-1].concat(n),t}),[""])}}class n{static is_not_empty_string(t){return!n.is_empty_string(t)}static is_empty_string(t){return null==t||null==t||!(t.length>0)}static get_from=(t,e,n)=>t.hasOwnProperty(e)?t[e]:n;static createElement=(t,e="",n=[],r="",o)=>{const l=document.createElement(t);return l.className=e,l.textContent=r,n.length>0&&n.forEach((t=>{l.appendChild(t)})),o&&Object.entries(o).forEach((([t,e])=>{l.setAttribute(t,e)})),l};static ce=(t,e="",n=[],r="",o)=>this.createElement(t,e,n,r,o);static decorate_menu_icon(t){return t.style.height="48px",t.style.backgroundColor="#f7f9fa",t.style.fontSize="28px",t.style.border="1px solid #e3e7e8",t.style.display="inline",t.style.marginLeft="2px",t.style.marginRight="2px",t.style.verticalAlign="middle",t}static simpleDiv=t=>n.createElement("div","",[],t);static is_overlapped=t=>n.overlapped(t).length>0;static overlapped=t=>{const e=t.filter(((t,e,n)=>n.indexOf(t)!==n.lastIndexOf(t)));return Array.from(new Set(e))};static get_application_url(t){return`${location.protocol}//${location.host}/k/${t}`}static retrieve_errors(t,e=-1){const n=t?.error?.errors;if(null==n)return;let r=[];if(Object.keys(n).forEach((t=>{const e=n[t].messages.map((e=>`[${t}] ${e}`));r=r.concat(e)})),r.sort(),e>=0&&e<r.length){const t=r.length-e;r=r.splice(0,e),r.push(`以下${t}件のエラーメッセージを省略しました。`)}return r}}class r{constructor(t){this.top_id=t}build(){this.build_forms(this.top_id)}build_forms(e){const o=document.getElementById(e);o?.setAttribute("class","ms-4 me-5");const l=n.ce("input","btn btn-primary mb-3",[],"",{type:"button",value:"実行",id:t.ID_BUTTON_RUN});l.addEventListener("click",r.run);const c=n.ce("input","float-end ms-2",[],"",{id:t.ID_LIMIT_LENGTH,value:`${t.LIMIT_LENGTH}`}),s=r.create_textarea(t.ID_TEXT_FROM,"入力テキスト");s.addEventListener("change",r.change_from);const i=r.create_textarea(t.ID_TEXT_TO,"読み上げ用テキスト");i.addEventListener("change",r.change_to);const a=n.ce("div","",[n.ce("span","float-end",[],"",{id:t.ID_LENGTH_FROM}),s,n.ce("div","float-end",[c],"分割文字数の目安: "),n.ce("div","",[l]),n.ce("span","float-end",[],"",{id:t.ID_LENGTH_TO}),i,n.ce("div","",[],"",{id:t.ID_BUTTONS})]);o?.append(a)}static run(){const o=r.get_from_field(),l=(r.get_to_field(),document.getElementById(t.ID_LIMIT_LENGTH)),c=new e(parseInt(l.value)).proc(o.value);console.log(c);const s=r.list_splitted_contents(c),i=n.ce("div","btn-group",s),a=document.getElementById(t.ID_BUTTONS);a&&(Array.from(a.childNodes).forEach((t=>{t.remove()})),a?.append(i)),s[0].dispatchEvent(new Event("click"))}static list_splitted_contents(t){const e=r.get_to_field();let o=0;return t.map((t=>{o++;const l=n.ce("input","btn  btn-secondary",[],"",{type:"button",value:`page ${o}`});return l.addEventListener("click",(n=>{e.value=t,r.change_to()})),l}))}static convert(e){if(null==e)return"";let n;const r=new RegExp(t.RE_SHRINK,"g");n=e.replace(r,"$1");const o=new RegExp(t.RE_URL,"g");return n=n.replace(o,"(URL)"),console.log(n.length),n}static change_from(){console.log("change from");const e=r.get_from_field().value.length,n=document.getElementById(t.ID_LENGTH_FROM);n&&(n.textContent=e.toString())}static change_to(){console.log("change to");const e=r.get_to_field().value.length,n=document.getElementById(t.ID_LENGTH_TO);n&&(n.textContent=e.toString())}static get_from_field(){const e=document.getElementById(t.ID_TEXT_FROM);if(null===e)throw new Error("fromノードが取得できませんでした。");return e}static get_to_field(){const e=document.getElementById(t.ID_TEXT_TO);if(null===e)throw new Error("toノードが取得できませんでした。");return e}static create_textarea(t,e){const r=n.ce("textarea","form-control",[],"",{id:t,cols:"10",rows:"10"});return r.style.overflowX="scroll",n.ce("div","mb-3",[n.ce("label","form-label",[],e,{for:t}),r])}}!function(){console.log("run script.");new r("app").build()}();